name: Test Workflow
on:
  pull_request:
    types:
      - opened
    branches:
      - main
      - 'dev-*'
      - 'dev/**'
  workflow_dispatch: # Even we are not using any option here but still we have to use colon for every trigger
  push:
    branches:
      - main
      - 'dev-*' # dev-new dev-this-is-new
      - 'dev/**' # dev/new_feat/new_change
#    paths-ignore:
#      - '.github/workflows/*' # If i push the change in workflow folder, the GitHub workflow won't start.
#    paths:
#      - 'notebooks/**' # Workflow will start only, if we do changes in these paths


jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - name: Get Code
        uses: actions/checkout@v4
      - name: Install Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'
      - name: Install Java
        uses: actions/setup-java@v4
        with:
          java-version: '21'
          distribution: temurin
      - name: Install Dependencies
        run: |
          pip install --upgrade pip
          pip install -r requirements.txt
      - name: Run Pytest and generate xml report
        run: pytest tests/test_pipeline.py --junitxml=test_results.xml

      - name: Upload test results
        uses: actions/upload-artifact@v4
        with:
          name: pytest-results
          path: test_results.xml

      - name: Publish test results in GitHub UI
        uses: mikepenz/action-junit-report@v3
        with:
          report_paths: 'test_results.xml'
          check_name: 'Pytest Results'

  Dev:
    needs: test
    runs-on: ubuntu-latest
    steps:
      - name: print hi
        run: echo "print hi"
